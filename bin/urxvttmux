#!/bin/bash

#export MOSH_TITLE_NOPREFIX=true

openurxvt ()
{
    cmd="$@"
    urxvt ++iso14755 ++iso14755_52 -title "$tmuxtitle" -e /bin/sh -c "$cmd" &
}

if [ "$1" = "local" ]; then
    tmuxtitle="$USER@$(hostname -s)"
    launchcmd="tmux attach"
else
    tmuxtitle="$1"
    launchcmd="mosh $1 tmux attach"
fi

currwin=$(xprop -id $(xprop -root _NET_ACTIVE_WINDOW | cut -d ' ' -f 5) WM_NAME | cut -d '"' -f 2)

# if we're already looking at tmux, maximise it
if [ "$currwin" = "$tmuxtitle" ]; then
    sleep 0.2
    wmctrl -r :ACTIVE: -b add,maximized_vert,maximized_horz
else
    # We're not looking at tmux.  Try to raise it.  If that fails, launch it.b
    if ! wmctrl -a "$tmuxtitle"; then
        openurxvt $launchcmd
    fi
fi
