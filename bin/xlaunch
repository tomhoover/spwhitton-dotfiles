#!/bin/bash
. $HOME/.shenv

# ---- prep

# Emacs needs a bunch of environment variables set for its Haskell
# setup to work

export HALCYON_BASE=$HOME/local/app
if [ -d "$HALCYON_BASE/halcyon" ]; then
    source <( HALCYON_NO_SELF_UPDATE=1 $HOME/local/app/halcyon/halcyon paths )
fi


# ---- do our work
case $1 in
    www)
        wmctrl -a Iceweasel || iceweasel &
        ;;
    emacs)
        if ! pgrep emacs; then
            emacs --daemon
        fi
        wmctrl -a emacs@`hostname -f` || emacsclient -c -F "((fullscreen . maximized))" &        
        ;;
    ma)
        wmctrl -a "spw@ma" || urxvtma &
        ;;
    term)
        currwin=$(xprop -id $(xprop -root _NET_ACTIVE_WINDOW | cut -d ' ' -f 5) WM_NAME | cut -d '"' -f 2)
        tmuxtitle="terms"
        # if we're already looking at tmux, maximise it
        if [ "$currwin" = "$tmuxtitle" ]; then
            sleep 0.2
            wmctrl -r :ACTIVE: -b add,maximized_vert,maximized_horz
        else
            # We're not looking at tmux.  Try to raise it.  If that fails, launch it.b
            if ! wmctrl -a "$tmuxtitle"; then
                urxvt ++iso14755 ++iso14755_52 -title "$tmuxtitle" -e /bin/sh -c 'tmux attach' &
            fi
        fi
        ;;
esac
