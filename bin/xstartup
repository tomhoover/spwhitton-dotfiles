#!/bin/sh

. $HOME/.shenv

# ---- no bell please

xset b off

# ---- keyboard settings

setxkbmap -option ctrl:nocaps
xmodmap ~/.xmodmaprc
xbindkeys

# enable numlock if using USB keyboard
lsusb | grep -q "Chicony Electronics Co., Ltd" \
    && numlockx on

# ---- GTK settings

# Note that at least some of these won't take effect until logging in
# again to restart services.

# Have the GNOME keyring daemon cache our GPG key passphrase for no
# more than 20 minutes.  Cache time cannot be controlled for SSH keys
gsettings set org.gnome.crypto.cache gpg-cache-ttl 1200
gsettings set org.gnome.crypto.cache gpg-cache-method 'timeout'

# ---- clear SSH keys out of gnome-keyring-daemon when idle (per GNOME
# ---- bug #525574 it can't do this itself yet)

pkill -u $USER idlesshclear
idlesshclear &

# ---- screen locking

# first replace light-locker with xscreensaver
pkill light-locker
pgrep -u "$USER" xscreensaver || xscreensaver &

# turn over lid switch handling to logind
xfconf-query -c xfce4-power-manager -n \
             -p /xfce4-power-manager/logind-handle-lid-switch \
             -t bool -s true

# ... and then use xss-lock to make sure the screen still gets locked
xss-lock -- xscreensaver-command -lock &

# ---- other stuff to launch

redshift-gtk -l 53.57:1.5 -t 6500:3700 &
caffeine-indicator &
firefox &
emacs --daemon

# ---- fire up my window manager

#exec xmonad --replace
