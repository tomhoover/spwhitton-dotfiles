#!/bin/sh

# mark all sent mail as read
notmuch tag -unread -- folder:sent

# ensure all drafts are in the drafts folder
floating_drafts=$(notmuch search --output=files -- tag:draft and not folder:drafts)
if [ ! -z "$floating_drafts" ]; then
    mv $floating_drafts $HOME/.fmail/drafts/cur
fi

# mark all drafts as drafts, and as read
notmuch tag -unread +draft -- folder:drafts

# propagate the 'killed' tag to all messages in the killed message's thread
killed_threads=$(notmuch search --output=threads tag:killed)
if [ ! -z "$killed_threads" ]; then
    notmuch tag -unread -- $killed_threads
fi
