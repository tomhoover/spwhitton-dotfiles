#!/bin/sh

. $HOME/.shenv

# mark all sent mail as read
notmuch tag -unread -- folder:sent

# mark all drafts as drafts, and as read
notmuch tag -unread +draft -- folder:drafts

# mark all spam as spam
notmuch tag +spam -- folder:spam

# mark all trash as trash
notmuch tag +deleted -- folder:trash

# propagate the 'killed' tag to all messages in the killed message's thread
killed_threads=$(notmuch search --output=threads tag:killed)
if [ ! -z "$killed_threads" ]; then
    notmuch tag -unread -- $killed_threads
fi

# start a background process to expand-annex-mboxes; mail in these
# will be processed on the next `notmuch new` run
( expand-annex-mboxes >/dev/null 2>&1 || exit 0 ) &
